generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model Roles {
  RolID       Int       @id @default(autoincrement())
  NombreRol   String
  Descripcion String?
  usuarios    Usuarios[]
}

model Usuarios {
  UsuarioID     Int       @id @default(autoincrement())
  Nombre        String
  Apellido      String
  Email         String    @unique
  PasswordHash  String
  Estado        Boolean   @default(true)
  FechaRegistro DateTime  @default(now())
  RolID         Int
  Rol           Roles     @relation(fields: [RolID], references: [RolID], onDelete: NoAction, onUpdate: NoAction)

  diagnosticos  Diagnosticos[]
  proformas     Proformas[]
  reportes      Reportes[]
}

model Clientes {
  ClienteID  Int      @id @default(autoincrement())
  Nombre     String
  Apellido   String
  CedulaRUC  String   @unique
  Telefono   String?
  Email      String?
  Direccion  String?
  equipos    Equipos[]
}

model Equipos {
  EquipoID     Int       @id @default(autoincrement())
  ClienteID    Int
  Descripcion  String
  NumeroSerie  String?
  FechaIngreso DateTime @default(now())
  Estado       String    @default("Ingresado")

  cliente      Clientes  @relation(fields: [ClienteID], references: [ClienteID], onDelete: NoAction, onUpdate: NoAction)
  diagnosticos Diagnosticos[]
}

model Diagnosticos {
  DiagnosticoID    Int       @id @default(autoincrement())
  EquipoID         Int
  TecnicoID        Int
  Observaciones    String?
  FechaDiagnostico DateTime @default(now())
  Estado           String    @default("En revisi√≥n")

  equipo    Equipos   @relation(fields: [EquipoID], references: [EquipoID], onDelete: NoAction, onUpdate: NoAction)
  tecnico   Usuarios  @relation(fields: [TecnicoID], references: [UsuarioID], onDelete: NoAction, onUpdate: NoAction)
  proformas Proformas[]
}

model Proformas {
  ProformaID    Int       @id @default(autoincrement())
  DiagnosticoID Int
  VendedorID    Int
  PrecioTotal   Decimal
  Impuestos     Decimal   @default(0)
  Descuento     Decimal   @default(0)
  Estado        String    @default("Pendiente")
  FechaEmision  DateTime  @default(now())

  diagnostico Diagnosticos @relation(fields: [DiagnosticoID], references: [DiagnosticoID], onDelete: NoAction, onUpdate: NoAction)
  vendedor    Usuarios     @relation(fields: [VendedorID], references: [UsuarioID], onDelete: NoAction, onUpdate: NoAction)
}

model Reportes {
  ReporteID       Int      @id @default(autoincrement())
  Tipo            String
  Descripcion     String?
  FechaGeneracion DateTime @default(now())
  GeneradoPor     Int

  usuario Usuarios @relation(fields: [GeneradoPor], references: [UsuarioID], onDelete: NoAction, onUpdate: NoAction)
}
